# Copyright (c) 2022, Prevas A/S
# SPDX-License-Identifier: Apache-2.0

description: |
  Quadrature Decoder driver which processes encoder signals to determine MR-BUGGY3 displacement

  with cooperation of S32K344 - eMIOS, TRGMUX and LCU modules.

  The sensor qdec application can be used for testing this driver.

  The following example uses TRGMUX IN2 and IN3 to connect to LCU1 LC0 I0 and I1.

  LCU1 LC0 O2 and O3 connect to eMIOS0 CH6(Clockwise rotation) and

  CH7(Counter Clockwise rotation) via TRGMUX_INT_OUT37 and TRGMUX_INT_OUT38

  micro-ticks-per-rev is set as per BUGGY3 gearbox reduction.

  lcu filters are set to capture maximum speed sensitivity and avoid channel noise.

  qdec0: qdec0 {
    compatible = "nxp,qdec-s32k";
    pinctrl-0 = <&qdec_s32k>;
    pinctrl-names = "default";
    status = "okay";
    lcu_inst = <1>;
    emios_inst = <0>;
    micro-ticks-per-rev = <685440000>;
    lcu-rise-fall-filter = <5>;
    lcu-glitch-filter = <2>;
    emios-channels = <6 7>;
    trgmux-maps = < 54 3 >, /* TRGMUX_OUT_37 <-> eMIOS0_CH6 */
        < 55 4 >; /* TRGMUX_OUT_38 <-> eMIOS0_CH7 */
  };


compatible: "nxp,qdec-s32k"

include: [pinctrl-device.yaml, sensor-device.yaml]

properties:
  micro-ticks-per-rev:
    type: int
    description: |
      This is a number that is used to determine how many revolutions * 1000000
      were done based on the current counter's value.

  lcu_inst:
    type: int
    description: |
      This gives the hardware instance of LCU module.

  emios_inst:
    type: int
    description: |
      This gives the hardware instance of eMIOS module.

  lcu-rise-fall-filter:
    type: int
    description: |
      This filter specifies the delay in terms of CORE_CLK between the input and the output line of LC.
      We use this delay to genarate short pulses at the rising and falling edges of input pulse.

  lcu-glitch-filter:
    type: int
    description: |
      This filter specifies the minimum width of the LC output pulse in terms of CORE_CLK.
      Any pulse less than this value will not be reflected on the output of LCU module.

  emios-channels:
    type: array
    description: |
      This is the array containing 2 emios channel TypeG numbers used by the qdec.
      See Table 342 in S32K3XXRM for more information

  trgmux-maps:
    type: array
    description: |
      Trgmux input and output mappings. Input is followed by the output.
      See S32K3XXRM S32K3XX_IOMUX.xlsx for more information
